<!DOCTYPE html> 
<html>
<!-- 
/**
 *  This file is part of NewsPro Application
 *  Copyright (C) 2012 Jignesh Kakadiya <jigneshhk1992@gmail.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as
 *  published by the Free Software Foundation, either version 3 of the
 *  License, or (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
 --> 
<head> 
<title>NewsPro</title> 
<!--
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.css" />	
<script src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
<script src="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.js"></script>-->

<link rel="stylesheet" href="css-js/jquery.mobile-1.0a2.min.css" />	
<script src="css-js/jquery-1.4.4.min.js"></script>
<script src="css-js/jquery.mobile-1.0a2.min.js"></script>
<script src="css-js/jsShare.js" type="text/javascript"></script>
<link href="css-js/jsShare.css" rel="stylesheet" type="text/css" />

<!-- <script src="css-js/jquery.ba-dotimeout.js"></script> --> 
<script src="css-js/jquery.dst.js"></script> 

<style> 
  	.conatiner{
		overflow:auto;
	}

	.clear {
   		height: 0;
   		font-size: 1px;
   		margin: 0;
   		padding: 0;
   		line-height: 0;
   		clear: both;
   	}

	.image{
		position:relative;
		border:4px solid black;
		border-radius: 5px;
		float:left;
	}
	
	.image a:hover{
		position:relative;
		border:4px solid white;
		border-radius: 5px;
		float:left;
	}

	.image1{
		position:relative;
		border:4px solid black;
		border-radius: 5px;
		float:right;
	}
	
	.image1 a:hover{
		position:relative;
		border:4px solid white;
		border-radius: 5px;
		float:right;
	}
		
	.t1 {
   		position: absolute;
		height: 68px; 
  		top: 100%; 
  		margin-top:-68px;   
   		down:20%;
		background-color:black;
  		color:white;
	    opacity:0.7;
		font-size:12px;
  	}
  	
  	p {
  	   text-align:justify;
  	} 

</style>
</head> 
<body> 
<!-- Container page -->


<div data-role="page" data-theme="a" id="home">

	<div data-role="header" id="homeHeader" data-nobackbtn="true">
		<!-- <div data-role="controlgroup" data-type="horizontal">
			<a href="" data-role="button" id="refreshButton" data-icon="refresh">Re</a>
			<a href="" data-role="button" id="prevButton" data-icon="arrow-l">Prev</a>
			<a href="#search" data-role="button" id="searchButton" data-icon="grid">Find</a>
			<a href="" data-role="button" id="nextButton" data-icon="arrow-r">Next</a>
			<a href="#settings" data-role="button" id="settingButton" data-icon="gear">Opt</a>
		</div>--> 
		<div  align="CENTER" class="ui-body ui-body-a" >
			<a href="#" data-role="button" id="refreshButton" data-icon="refresh"  data-inline="true">&nbsp</a>
			<a href="#" data-role="button" id="prevButton" data-icon="arrow-l"  data-inline="true"> &nbsp</a>
			<a href="#search" data-role="button" id="searchButton" data-icon="grid"  data-inline="true">&nbsp</a>
			<a href="#" data-role="button" id="nextButton" data-icon="arrow-r"  data-inline="true"> &nbsp</a>
			<a href="#settings" data-role="button" id="settingButton" data-icon="gear"  data-inline="true"> &nbsp</a>
		</div> 
		<h1 id="currentCategory">Categories</h1>
	</div>
	
	<div data-role="content" id="homeContent">
		<div data-role="content" id="contentProgress">
		<div align="CENTER"><h4>Please wait.</h4></div>
		<div align="CENTER"><img id="spin" src="img/wait.gif"/></div>
		<br/><br/><br/><br/><br/>
		<br/><br/><br/><br/><br/>
		<br/><br/><br/><br/><br/>	
	</div>
    </div>
	
	<div data-role="footer" id="homeFooter">
		<h1 id="homeFooter"></h1>
	</div>

</div>
<!-- settings -->
<div data-role="page" data-theme="a" id="settings">

	<div data-role="header" id="settingsHeader" data-nobackbtn="true">
		<div class="ui-body ui-body-a" >
			<a href="#home" data-role="button" data-icon="arrow-l"  data-inline="true">&nbsp</a>
		</div>
		<h1> Settings </h1>
		<!--<div data-role="controlgroup" data-type="horizontal">
			<a href="#home" data-role="button" data-icon="arrow-l">Home</a>
		</div>-->

	</div>
	
	<div data-role="content" id="settingsContent">
		<fieldset data-role="controlgroup">
	    <input type="checkbox" name="c0" id="c0" onClick="updateSetting(0)"/>
			<label for="c0">TopStories</label>
	    <input type="checkbox" name="c1" id="c1" onClick="updateSetting(1)"/>
			<label for="c1">Entertainment</label>
			<input type="checkbox" name="c2" id="c2" onClick="updateSetting(2)"/>
			<label for="c2">Arts</label>
			<input type="checkbox" name="c3" id="c3" onClick="updateSetting(3)"/>
			<label for="c3">Business</label>
			<input type="checkbox" name="c4" id="c4" onClick="updateSetting(4)"/>
			<label for="c4">Sports</label>
			<input type="checkbox" name="c5" id="c5" onClick="updateSetting(5)"/>
			<label for="c5">Technology</label>
			<input type="checkbox" name="c6" id="c6" onClick="updateSetting(6)"/>
			<label for="c6">Ahmedabad</label>
			<input type="checkbox" name="c7" id="c7" onClick="updateSetting(7)"/>
			<label for="c7">Chandigarh</label>
		</fieldset>	
	</div>
	
	<div data-role="footer" id="settingsFooter">
		<a href="#home" data-role="button" data-icon="arrow-l">&nbsp</a>
	</div>
	
</div>

<div data-role="page" data-theme="a" id="article">

	<div data-role="header" id="articleHeader" data-nobackbtn="true">
		<div class="ui-body ui-body-a" >
			<a href="#" data-role="button" id="articleBackH" data-icon="arrow-l"  data-inline="true">&nbsp</a>
		</div>
		<!-- <h1 id="articleHead"> Article </h1> -->
		<div id="shareButtons">
        </div>
	</div>
	
	<div data-role="content" id="articleContent">
	</div>
	
	<div data-role="footer" id="articleFooter">
		<a href="#" data-role="button" id="articleBackF" data-icon="arrow-l">&nbsp</a> 
	</div>
	
</div>

<div data-role="page" data-theme="a" id="search">

	<div data-role="header" id="searchHeader" data-nobackbtn="true">
		<div class="ui-body ui-body-a" >
			<a href="#home" data-role="button" id ="searchBack" data-icon="arrow-l"  data-inline="true"> &nbsp</a>
		</div>
		<h1> Search </h1>
	</div>
	
	<div data-role="content" id="searchContent">
		<form id="searchForm" method="GET">
			<div data-role="fieldContain">
                <input type="text" name="queryName" id="query" value="Search" onFocus="this.value='';" />
                <a href="#" data-role="button" data-icon="refresh" id="goButton" >Go</a>
            </div>
            <div id="searchResult">
            </div>
        </form>
	</div>
	
	<div data-role="footer" id="searchFooter">
	</div>
</div>
<script>
  var catURI="http://ec2-23-20-208-77.compute-1.amazonaws.com:8080/topics-server-side/StoriesProviderMobile?numofarticles=20&topic=";
  var srchURI = "http://ec2-23-20-208-77.compute-1.amazonaws.com:8080/topics-server-side/SearchResultsProvider?query=";
  var onSearchPage= false;
  var onCatPage = true;
  var COOKIE = 'news'
  var setting='11111111'
  var homeContentVar = $('#homeContent');
  var searchBack = $('#searchBack');
  var searchButton = $('#searchButton');
  var nextButton = $('#nextButton');
  var prevButton = $('#prevButton');
  var refButton = $('#refButton');
  var currentCategory = $('#currentCategory')
  var searchContent = $('#searchContent')
  var refreshButton = $('#refreshButton')
  var articleHeading = $('#articleHead')
  var homeFooter = $('#homeFooter')
  var settingContent = $('#settingContent')
  var searchResult = $('#searchResult')
  var categories = [{ name: "TopStories", selected: 1 },
                    { name: "Entertainment", selected: 1 },
                    { name: "Arts", selected: 1 },
                    { name: "Business", selected: 1},
                    { name: "Sports", selected: 1 },
                    { name: "Technology", selected: 1 },
                    { name: "Ahmedabad", selected: 1 },
                    { name: "Chandigarh", selected:0 }
                   ]
  var goButton = $('#goButton')
  var shifter = 0;
  var globalCategoryData;
  var globalSearchData;
  
/** Populate the division with news title and source on images */
function displayNews(data)
{
  var text="";
  var i=0;
  onSearchPage = false
  onCatPage = true
  globalCategoryData = data;
  var j=0;
  for (i=0;i<data.length;i=i+2)
  {
    j = i+1;
    src="http://ec2-23-20-208-77.compute-1.amazonaws.com:8080/topics-server-side/ImageProvider?articleid=";

    imgLink1 = src + data[i].articleId+ "&scale=140";
    titleL = manageLength(data[i].title);
    srcL = 'By : '+ data[i].source;
    textL = '<div class=t1> Title:' + titleL + '<br>' + srcL +' </div>'
    var imgleft= '<div class="image" > <a href="#article"> <img src='+ imgLink1 
    imgleft = imgleft + ' alt="" height="130px" width="130px" onClick="displayArticle('+i+')"/></a>'+ textL +'</div>'
    if(j<data.length)
    {
      imgLink2 = src + data[j].articleId +"&scale=140";
      titleR = manageLength(data[j].title);
      srcR = 'By : '+ data[j].source;
      textR = '<div class=t1 > Title: '+ titleR +'<br>'+ srcR + '</div> '  
      var imgright = '<div class="image1" > <a href="#article"><img src=' + imgLink2 
      imgright = imgright + ' alt="" height="130px" width="130px" onClick="displayArticle('+j+')"/></a>'+ textR  
      imgright = imgright + '</div> <div class="clear"></div> '
    } else {
      var imgright ='';
    }
    clear = '</div><div class="clear">'
    text+='<div class="container">' + imgleft+ ' '+ imgright +"<br/>"
    }
    homeContentVar.html(text);
}

/** Populate at he end of the division */
function appendNews(data)
{
  var text="";
  var i=0;
  var j=0;
  globalSearchData = data;
  onSearchPage = true
  onCatPage = false
  for (i=0;i<data.length;i=i+2)
  {
    j = i+1;
    src="http://ec2-23-20-208-77.compute-1.amazonaws.com:8080/topics-server-side/ImageProvider?articleid=";
    imgLink1 = src + data[i].articleId+ "&scale=140";
    titleL = manageLength(data[i].title);
    srcL = 'By : '+ data[i].source;
    textL = '<div class=t1> Title:' + titleL + '<br>' + srcL +' </div>'
    var imgleft= '<div class="image" > <a href="#article"> <img src='+ imgLink1 
    imgleft = imgleft + ' alt="" height="130px" width="130px" onClick="displayArticle('+i+')"/></a>'+ textL +'</div>'
    if(j<data.length) {
      imgLink2 = src + data[j].articleId +"&scale=140";
      titleR = manageLength(data[j].title);
      srcR = 'By : '+ data[j].source;
      textR = '<div class=t1 > Title: '+ titleR +'<br>'+ srcR + '</div> '  
      var imgright = '<div class="image1" > <a href="#article"><img src=' + imgLink2 
      imgright = imgright + ' alt="" height="130px" width="130px" onClick="displayArticle('+j+')"/></a>'+ textR  
      imgright = imgright + '</div> <div class="clear"></div> '
    } else {
      var imgright ='';
    }
    clear = '</div><div class="clear">'
    text+='<div class="container">' + imgleft+ ' '+ imgright +"<br/>"
  }
  searchResult.html(searchContent.innerHTML+text);
}

/** Displays perticular article */
function displayArticle(i)
{
  console.log("back on article page")
  if(onSearchPage) {
    data=globalSearchData;
    document.getElementById('articleBackH').href='#search';
    document.getElementById('articleBackF').href='#search';
  }
  if(onCatPage) {
    data = globalCategoryData;
    document.getElementById('articleBackH').href='#home';
    document.getElementById('articleBackF').href='#home';
  }
  var articleContent = $('#articleContent');
  var title='<h1 align="middle">'+data[i].title+'</h1><br>';
  var imgSrc="http://ec2-23-20-208-77.compute-1.amazonaws.com:8080/topics-server-side/ImageProvider?articleid="
  imgSrc = imgSrc +data[i].articleId+"&scale=140";
  var img='<img src='+imgSrc+' height:"100%" width="100%" align="middle" /><br>';
  var text='<p>' + data[i].displayContent + '</p>';
  articleHeading.text(categories[shifter].name)
  articleContent.html(title + img + text);	  
}

/** if title length is greater than 40 trim it */
function manageLength(data)
{
  if(data.length > 40)
    return data.substring(0,40)+ '...';
  return data;
}

  /** get json from passed link and hadle it via handler */
  /*function getJson( uri , handler)
  {
    $.getJSON( uri,handler);
  }*/

function getJson( uri , handler)
{
  $.get(uri, handler,'jsonp');
}

searchBack.click(function() {
  onCatPage = true;
  onSearchPage = false;
});

searchButton.click(function(){
  onCatPage = false;
  onSearchPage = true;
});

/** search button */
goButton.click(function() {
  var URI = srchURI;
  URI = URI + $('#query').val() + "&numofarticles=10"
  searchResult.html("");
  getJson(URI, appendNews);
});

/** Refetch the Json and reload the page */
refreshButton.click(function() {
  var URI = catURI;
  cName = categories[shifter].name
  URI = URI+ cName
  getJson(URI , displayNews);
  currentCategory.text(cName);
});

/** Change to next Category */
nextButton.click(function() {
  do {
    shifter = shifter + 1;
    if(shifter == categories.length)
      shifter = 0
  } while(!categories[shifter].selected)
  var URI = catURI;
  cName = categories[shifter].name
  URI = URI+cName
  getJson(URI, displayNews);
  currentCategory.fadeOut(function(){
    currentCategory.text(cName)
    currentCategory.fadeIn();
  });
  currentCategory.fadeIn();
  homeFooter.text(cName)
  return false;
});

/** Change to previous category */
prevButton.click(function() {
  do {
    shifter = shifter - 1;
    if (shifter < 0)
      shifter = categories.length -1
  } while(!categories[shifter].selected)
  var URI = catURI;
  cName = categories[shifter].name;
  URI = URI+cName;
  getJson(URI, displayNews);
  currentCategory.fadeOut(function(){
    currentCategory.text(cName)
    currentCategory.fadeIn();
  });
  currentCategory.fadeIn();
  homeFooter.text(cName);
  return false;
});

function updateSetting(i){
  $.DSt.set(COOKIE, '');
  var c = "#c"+i;

  if($(c).is(':checked')) {
    categories[i].selected = 1;
  } else {
    categories[i].selected = 0;
  }
  setting = ''
  for(j=0; j< categories.length; j++) {
    setting = setting+categories[j].selected
  }
  $.DSt.set(COOKIE, setting);
  console.log($(c).is(':checked') + " and "+ setting);
}

function setPreviousSetting()
{
  setting = $.DSt.get(COOKIE);
  console.log(setting);
  if( setting != null && setting.length > 0) {
    for(i=0; i< categories.length; i++)
    {
      c = '#c'+i;
      if(setting[i]== 1) { 
        categories[i].selected = 1
        $(c).attr("checked", true).checkboxradio("refresh");
      } else {
        categories[i].selected = 0
        $(c).attr("checked", false).checkboxradio("refresh");
      }
      c = '#c'
    }
  } else {
     for(i=0; i< categories.length; i++)
     {
       c = '#c'+i;
       categories[i].selected = 1;
       $(c).attr("checked", true).checkboxradio("refresh");
     }
  }
}

/** Called by Android to change location of URI */
function changeLocation(varURI){
  $.get('',function(data){
  window.location = varURI;
  });
  }

/** Execute when document is loaded */
$(document).ready(function () {
  var URI = catURI
  $('#shareButtons').jsShare({ maxwidth: 360 });
  setPreviousSetting();
  for(var i=0; i<categories.length;i++)
  {
     if(categories[i].selected) {
       shifter = i;
       currentCategory.text(categories[shifter].name)
       getJson(URI+categories[shifter].name, displayNews);
       break
     }
  }
});

</script>
</body>
</html>
